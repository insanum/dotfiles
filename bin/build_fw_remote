#!/bin/bash

if [[ -z "$1" ]]; then
    echo "Usage: <target> = thor_e | thor | creole_e | creole "
    echo "Usage: $0 gitclean"
    echo "Usage: $0 <target> clean"
    echo "Usage: $0 <target> [-r local_repo] [debug]"
    echo "Usage: $0 <target> [-r local_repo] [debug] [coverity]"
    exit
fi

RUSER=ed927285
#RHOST=10.13.249.218
RHOST=lvnvdb3254.lvn.broadcom.net
#RHOST=xlinux.irv.broadcom.com

DREPO=nx
LREPO=${HOME}/work/git/${DREPO}/main/Cumulus

if [[ "$1" = "-r" ]]; then
    echo "--> Building from repo: $2"
    LREPO=${HOME}/work/git/${2}/main/Cumulus
    shift
    shift
else
    echo "--> Building from repo: $DREPO"
fi

RREPO=/projects/ccx-sw-arch/edavis/git/nx_build/main/Cumulus

if [[ "$1" == gitclean ]]; then
    echo "*************"
    echo "* GIT CLEAN *"
    echo "*************"
    ssh ${RUSER}@${RHOST} ./build_fw gitclean
elif [[ "$2" == clean ]]; then
    echo "************"
    echo "* CLEANING *"
    echo "************"
    ssh ${RUSER}@${RHOST} ./build_fw $1 clean
else
    echo "**************************************"
    echo "* RSYNC: main/Cumulus/common/include *"
    echo "**************************************"
    rsync -avP ${LREPO}/common/include ${RUSER}@${RHOST}:${RREPO}/common/

    #echo "**************************************"
    #echo "* RSYNC: main/Cumulus/drivers *"
    #echo "**************************************"
    #rsync -avP ${LREPO}/drivers ${RUSER}@${RHOST}:${RREPO}/

    echo "********************************"
    echo "* RSYNC: main/Cumulus/firmware *"
    echo "********************************"
    rsync -avP --exclude 'RTOS/*' ${LREPO}/firmware ${RUSER}@${RHOST}:${RREPO}/

    echo "************"
    echo "* BUILDING *"
    echo "************"
    ssh ${RUSER}@${RHOST} ./build_fw $*
fi

